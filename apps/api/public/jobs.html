<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="/logo.png">
  <title>Jobs - VERGO Events</title>
  <meta name="description" content="Find bartending, waiting, and chef opportunities in London. Browse available shifts and apply to join the VERGO Events team.">
  
  <style>
    /* ============================================
     * STANDARD HEADER & NAV STYLES
     * ============================================ */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(10, 10, 10, 0.98);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(212, 175, 55, 0.2);
      padding: 15px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
    }
    
    .logo {
      display: flex;
      align-items: center;
      text-decoration: none;
    }
    
    .logo img {
      height: 45px;
      width: auto;
      transition: transform 0.3s ease;
      border: none !important;
      background: transparent !important;
      display: block;
    }
    
    .logo:hover img {
      transform: scale(1.05);
    }
    
    nav ul {
      display: flex;
      gap: 30px;
      list-style: none;
      margin: 0;
      padding: 0;
    }
    
    nav li {
      position: relative;
    }
    
    nav a {
      color: #ffffff;
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
      transition: color 0.3s ease;
      position: relative;
      display: block;
      padding: 8px 0;
    }
    
    nav a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: #D4AF37;
      transition: width 0.3s ease;
    }
    
    nav a:hover {
      color: #D4AF37;
    }
    
    nav a:hover::after {
      width: 100%;
    }
    
    nav a[aria-current="page"] {
      color: #D4AF37;
    }
    
    nav a[aria-current="page"]::after {
      width: 100%;
    }
    
    /* Dropdown Styles */
    .nav-dropdown {
      position: relative;
    }
    
    .nav-dropdown > a {
      cursor: pointer;
    }
    
    .nav-dropdown > a::before {
      content: '‚ñº';
      font-size: 0.6rem;
      margin-left: 5px;
      display: inline-block;
      transition: transform 0.3s ease;
    }
    
    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      background: rgba(10, 10, 10, 0.98);
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 4px;
      min-width: 180px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      margin-top: 5px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      padding: 0;
    }
    
    .nav-dropdown:hover .dropdown-menu,
    .nav-dropdown.active .dropdown-menu {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .nav-dropdown.active > a::before {
      transform: rotate(180deg);
    }
    
    .dropdown-menu li {
      list-style: none;
    }
    
    .dropdown-menu a {
      padding: 12px 18px;
      display: block;
      color: #ffffff;
      border-bottom: 1px solid rgba(212, 175, 55, 0.1);
      font-size: 0.85rem;
    }
    
    .dropdown-menu a::after {
      display: none;
    }
    
    .dropdown-menu li:last-child a {
      border-bottom: none;
    }
    
    .dropdown-menu a:hover {
      background: rgba(212, 175, 55, 0.1);
      color: #D4AF37;
    }
    
    /* Mobile Menu Toggle */
    .menu-toggle {
      display: none;
      flex-direction: column;
      gap: 5px;
      cursor: pointer;
      background: none;
      border: none;
      padding: 8px;
    }
    
    .menu-toggle span {
      width: 24px;
      height: 2px;
      background: #D4AF37;
      transition: all 0.3s ease;
    }
    
    /* Mobile Responsive */
    @media (max-width: 900px) {
      header {
        padding: 12px 20px;
      }
      
      .logo img {
        height: 38px;
      }
      
      nav ul {
        position: fixed;
        top: 65px;
        left: 0;
        right: 0;
        background: rgba(10, 10, 10, 0.98);
        flex-direction: column;
        padding: 20px;
        gap: 0;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        border-bottom: 1px solid rgba(212, 175, 55, 0.2);
      }
      
      nav ul.active {
        transform: translateX(0);
      }
      
      nav li {
        border-bottom: 1px solid rgba(212, 175, 55, 0.1);
      }
      
      nav li:last-child {
        border-bottom: none;
      }
      
      nav a {
        padding: 15px 10px;
      }
      
      .menu-toggle {
        display: flex;
      }
      
      /* Mobile dropdown */
      .dropdown-menu {
        position: static;
        opacity: 1;
        visibility: visible;
        transform: none;
        margin: 0;
        padding-left: 15px;
        display: none;
        border: none;
        box-shadow: none;
        background: transparent;
      }
      
      .nav-dropdown.active .dropdown-menu {
        display: block;
      }
      
      .dropdown-menu a {
        padding: 12px 10px;
        border-bottom: none;
      }
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: #0a0a0a;
      color: #ffffff;
      min-height: 100vh;
    }
    
    /* Header */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(10, 10, 10, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(212, 175, 55, 0.2);
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
    }
    
    .logo img {
      height: 50px;
      width: auto;
    }
    
    nav ul {
      display: flex;
      gap: 35px;
      list-style: none;
    }
    
    nav a {
      color: #ffffff;
      text-decoration: none;
      font-size: 0.95rem;
      font-weight: 500;
      transition: color 0.3s ease;
    }
    
    nav a:hover, nav a.active {
      color: #D4AF37;
    }
    
    .menu-toggle {
      display: none;
      flex-direction: column;
      gap: 5px;
      cursor: pointer;
      background: none;
      border: none;
    }
    
    .menu-toggle span {
      width: 25px;
      height: 2px;
      background: #D4AF37;
    }
    
    /* Main Content */
    main {
      padding: 120px 20px 60px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    /* Page Header */
    .page-header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .page-header h1 {
      font-size: 2.5rem;
      color: #D4AF37;
      margin-bottom: 10px;
    }
    
    .page-header p {
      color: #999;
      font-size: 1.1rem;
    }
    
    /* User Bar */
    .user-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 15px 20px;
      background: #1a1a1a;
      border-radius: 8px;
      border: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    .user-bar.logged-out {
      justify-content: flex-end;
    }
    
    .user-info {
      color: #ccc;
    }
    
    .user-info strong {
      color: #D4AF37;
    }
    
    .user-actions {
      display: flex;
      gap: 15px;
    }
    
    .btn {
      padding: 10px 20px;
      border-radius: 4px;
      font-weight: 600;
      font-size: 0.9rem;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
    }
    
    .btn-primary {
      background: #D4AF37;
      color: #1a1a1a;
    }
    
    .btn-primary:hover {
      background: #e5c349;
    }
    
    .btn-secondary {
      background: transparent;
      color: #D4AF37;
      border: 1px solid #D4AF37;
    }
    
    .btn-secondary:hover {
      background: rgba(212, 175, 55, 0.1);
    }
    
    .btn-small {
      padding: 8px 16px;
      font-size: 0.85rem;
    }
    
    /* Filters */
    .filters {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    
    .filter-group {
      flex: 1;
      min-width: 200px;
    }
    
    .filter-group label {
      display: block;
      color: #999;
      font-size: 0.85rem;
      margin-bottom: 5px;
    }
    
    .filter-group select {
      width: 100%;
      padding: 12px 15px;
      background: #1a1a1a;
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 4px;
      color: #fff;
      font-size: 0.95rem;
      cursor: pointer;
    }
    
    .filter-group select:focus {
      outline: none;
      border-color: #D4AF37;
    }
    
    /* Jobs Grid */
    .jobs-grid {
      display: grid;
      gap: 20px;
    }
    
    .job-card {
      background: #1a1a1a;
      border: 1px solid rgba(212, 175, 55, 0.2);
      border-radius: 8px;
      padding: 25px;
      transition: all 0.3s ease;
    }
    
    .job-card:hover {
      border-color: #D4AF37;
      transform: translateY(-2px);
    }
    
    .job-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
      gap: 15px;
    }
    
    .job-title {
      font-size: 1.3rem;
      color: #fff;
      margin-bottom: 5px;
    }
    
    .job-role {
      display: inline-block;
      background: rgba(212, 175, 55, 0.1);
      color: #D4AF37;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .job-type {
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 600;
      white-space: nowrap;
    }
    
    .job-type.internal {
      background: rgba(40, 167, 69, 0.2);
      color: #28a745;
    }
    
    .job-type.external {
      background: rgba(0, 123, 255, 0.2);
      color: #007bff;
    }
    
    .job-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 15px;
      color: #999;
      font-size: 0.9rem;
    }
    
    .job-meta span {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .job-description {
      color: #ccc;
      line-height: 1.6;
      margin-bottom: 20px;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .job-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 15px;
      border-top: 1px solid rgba(212, 175, 55, 0.1);
    }
    
    .job-pay {
      font-size: 1.1rem;
      color: #D4AF37;
      font-weight: 600;
    }
    
    .spots-left {
      color: #999;
      font-size: 0.85rem;
    }
    
    .spots-left.urgent {
      color: #ff6b6b;
    }
    
    /* Loading & Empty States */
    .loading, .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(212, 175, 55, 0.2);
      border-top-color: #D4AF37;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .empty-state h3 {
      color: #fff;
      margin-bottom: 10px;
    }
    
    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 40px;
    }
    
    .pagination button {
      padding: 10px 20px;
      background: #1a1a1a;
      border: 1px solid rgba(212, 175, 55, 0.3);
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .pagination button:hover:not(:disabled) {
      border-color: #D4AF37;
      background: rgba(212, 175, 55, 0.1);
    }
    
    .pagination button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .pagination .current {
      color: #D4AF37;
    }
    
    /* Footer */
    footer {
      background: #0a0a0a;
      color: #666;
      padding: 30px;
      text-align: center;
      border-top: 1px solid rgba(212, 175, 55, 0.2);
      font-size: 0.85rem;
    }
    
    footer a {
      color: #D4AF37;
      text-decoration: none;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      header {
        padding: 15px 20px;
      }
      
      nav ul {
        position: fixed;
        top: 70px;
        left: 0;
        right: 0;
        background: rgba(10, 10, 10, 0.98);
        flex-direction: column;
        padding: 20px;
        gap: 15px;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }
      
      nav ul.active {
        transform: translateX(0);
      }
      
      .menu-toggle {
        display: flex;
      }
      
      main {
        padding: 100px 15px 40px;
      }
      
      .page-header h1 {
        font-size: 1.8rem;
      }
      
      .user-bar {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .filters {
        flex-direction: column;
      }
      
      .filter-group {
        min-width: 100%;
      }
      
      .job-header {
        flex-direction: column;
      }
      
      .job-footer {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }
    }
  </style>
  <link rel="stylesheet" href="/vergo-mobile.css">
</head>
<body>
    <header role="banner">
    <a href="index.html" class="logo" aria-label="VERGO Events Home">
      <img src="/logo.png" alt="VERGO Events Logo">
    </a>
    
    <button class="menu-toggle" onclick="toggleMenu()" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="nav-menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
    
    <nav role="navigation" aria-label="Main navigation">
      <ul id="nav-menu">
        <li><a href="index.html">Home</a></li>
        <li class="nav-dropdown" id="services-dropdown">
          <a href="#" onclick="toggleDropdown(event, 'services-dropdown'); return false;" aria-haspopup="true" aria-expanded="false">Services</a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="hire-staff.html" role="menuitem">Hire Staff</a></li>
            <li><a href="hire-us.html" role="menuitem">Event Management</a></li>
          </ul>
        </li>
        <li><a href="jobs.html" aria-current="page">Job Board</a></li>
        <li><a href="apply.html">Join VERGO</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="faq.html">FAQ</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>
  </header>
  
  <main>
    <div class="page-header">
      <h1>Available Jobs</h1>
      <p>Find your next opportunity in London's events industry</p>
    </div>
    
    <!-- User Bar -->
    <div id="user-bar" class="user-bar logged-out">
      <div class="user-actions">
        <a href="user-login.html" class="btn btn-secondary btn-small">Log In</a>
        <a href="user-register.html" class="btn btn-primary btn-small">Create Account</a>
      </div>
    </div>
    
    <!-- Filters -->
    <div class="filters">
      <div class="filter-group">
        <label>Role</label>
        <select id="filter-role">
          <option value="">All Roles</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Type</label>
        <select id="filter-type">
          <option value="">All Types</option>
          <option value="INTERNAL">VERGO Jobs</option>
          <option value="EXTERNAL">External Jobs</option>
        </select>
      </div>
    </div>
    
    <!-- Jobs List -->
    <div id="jobs-container">
      <div class="loading">
        <div class="loading-spinner"></div>
        <p>Loading jobs...</p>
      </div>
    </div>
    
    <!-- Pagination -->
    <div id="pagination" class="pagination" style="display: none;"></div>
  </main>
  
    <!-- Footer -->
  <footer role="contentinfo">
    <div class="footer-content">
      <div class="footer-column">
        <h3>About Us</h3>
        <p>
          Premium event staffing solutions founded by industry veterans. Combining 8+ years 
          of hands-on experience with decades of family business expertise in the film and music sectors.
        </p>
        <p style="margin-top: 20px; font-size: 0.85rem; color: #666;">
          Fully Insured ‚Ä¢ DBS Checked
        </p>
      </div>
      
      <div class="footer-column">
        <h3>Services</h3>
        <a href="hire-staff.html">Event Staffing</a>
        <a href="hire-us.html">Event Management</a>
        <a href="apply.html">Join Our Team</a>
        <a href="about.html">About Us</a>
        <a href="contact.html">Get a Quote</a>
      </div>
      
      <div class="footer-column">
        <h3>Contact Founder</h3>
        <p><strong>Direct:</strong> <a href="tel:+447944505783" style="color: #999;">+44 7944 505 783</a></p>
        <p><strong>Email:</strong> <a href="/cdn-cgi/l/email-protection#2057524f424260564552474f4c54440e434f4d" style="color: #999;"><span class="__cf_email__" data-cfemail="f98e8b969b9bb98f9c8b9e96958d9dd79a9694">[email&#160;protected]</span></a></p>
        <p><strong>Location:</strong> London, UK</p>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 VERGO Events Ltd. All rights reserved.</p>
      <p style="margin-top: 5px;">
        <a href="privacy.html" style="color: #666; text-decoration: none;">Privacy</a> | 
        <a href="terms.html" style="color: #666; text-decoration: none;">Terms</a>
      </p>
    </div>
  </footer>
  
  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
    // State
    let currentUser = null;
    let currentPage = 1;
    let totalPages = 1;
    let filters = { roleId: '', type: '' };
    
    // Check auth status
    async function checkAuth() {
      try {
        const res = await fetch('/api/v1/user/session');
        const data = await res.json();
        
        if (data.authenticated) {
          currentUser = data.user;
          renderUserBar();
        }
      } catch (err) {
        console.error('Auth check failed:', err);
      }
    }
    
    // Render user bar
    function renderUserBar() {
      const bar = document.getElementById('user-bar');
      
      if (currentUser) {
        bar.className = 'user-bar';
        bar.innerHTML = `
          <div class="user-info">
            Welcome, <strong>${currentUser.firstName}</strong>
          </div>
          <div class="user-actions">
            <a href="user-dashboard.html" class="btn btn-secondary btn-small">My Applications</a>
            <button onclick="logout()" class="btn btn-small" style="background: #333; color: #fff;">Log Out</button>
          </div>
        `;
      } else {
        bar.className = 'user-bar logged-out';
        bar.innerHTML = `
          <div class="user-actions">
            <a href="user-login.html" class="btn btn-secondary btn-small">Log In</a>
            <a href="user-register.html" class="btn btn-primary btn-small">Create Account</a>
          </div>
        `;
      }
    }
    
    // Logout
    async function logout() {
      try {
        await fetch('/api/v1/user/logout', { method: 'POST' });
        currentUser = null;
        renderUserBar();
      } catch (err) {
        console.error('Logout failed:', err);
      }
    }
    
    // Load roles for filter
    async function loadRoles() {
      try {
        const res = await fetch('/api/v1/jobs/meta/roles');
        const roles = await res.json();
        
        const select = document.getElementById('filter-role');
        roles.forEach(role => {
          const opt = document.createElement('option');
          opt.value = role.id;
          opt.textContent = role.name;
          select.appendChild(opt);
        });
      } catch (err) {
        console.error('Failed to load roles:', err);
      }
    }
    
    // Load jobs
    async function loadJobs(page = 1) {
      const container = document.getElementById('jobs-container');
      container.innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>Loading jobs...</p></div>';
      
      try {
        const params = new URLSearchParams({ page, limit: 20 });
        if (filters.roleId) params.append('roleId', filters.roleId);
        if (filters.type) params.append('type', filters.type);
        
        const res = await fetch(`/api/v1/jobs?${params}`);
        const data = await res.json();
        
        currentPage = data.pagination.page;
        totalPages = data.pagination.totalPages;
        
        if (data.jobs.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <h3>No jobs available</h3>
              <p>Check back soon for new opportunities!</p>
            </div>
          `;
          document.getElementById('pagination').style.display = 'none';
          return;
        }
        
        container.innerHTML = '<div class="jobs-grid">' + data.jobs.map(renderJobCard).join('') + '</div>';
        renderPagination();
        
      } catch (err) {
        console.error('Failed to load jobs:', err);
        container.innerHTML = '<div class="empty-state"><h3>Failed to load jobs</h3><p>Please try again later.</p></div>';
      }
    }
    
    // Render job card
    function renderJobCard(job) {
      const date = job.eventDate 
        ? new Date(job.eventDate).toLocaleDateString('en-GB', { weekday: 'short', day: 'numeric', month: 'short' })
        : 'Flexible';
      
      const time = job.shiftStart && job.shiftEnd 
        ? `${job.shiftStart} - ${job.shiftEnd}` 
        : 'TBC';
      
      const pay = job.payRate 
        ? `¬£${job.payRate}/${job.payType === 'HOURLY' ? 'hr' : job.payType === 'DAILY' ? 'day' : 'fixed'}`
        : 'Competitive';
      
      const spotsClass = job.spotsLeft <= 2 ? 'urgent' : '';
      const typeClass = job.type === 'INTERNAL' ? 'internal' : 'external';
      const typeLabel = job.type === 'INTERNAL' ? 'VERGO' : job.companyName || 'External';
      
      return `
        <div class="job-card">
          <div class="job-header">
            <div>
              <h3 class="job-title">${escapeHtml(job.title)}</h3>
              <span class="job-role">${escapeHtml(job.role.name)}</span>
            </div>
            <span class="job-type ${typeClass}">${escapeHtml(typeLabel)}</span>
          </div>
          
          <div class="job-meta">
            <span>üìç ${escapeHtml(job.location)}</span>
            <span>üìÖ ${date}</span>
            <span>‚è∞ ${time}</span>
          </div>
          
          <p class="job-description">${escapeHtml(job.description)}</p>
          
          <div class="job-footer">
            <div>
              <span class="job-pay">${pay}</span>
              <span class="spots-left ${spotsClass}"> ¬∑ ${job.spotsLeft} spot${job.spotsLeft !== 1 ? 's' : ''} left</span>
            </div>
            <a href="job-detail.html?id=${job.id}" class="btn btn-primary btn-small">View & Apply</a>
          </div>
        </div>
      `;
    }
    
    // Render pagination
    function renderPagination() {
      const container = document.getElementById('pagination');
      
      if (totalPages <= 1) {
        container.style.display = 'none';
        return;
      }
      
      container.style.display = 'flex';
      container.innerHTML = `
        <button onclick="loadJobs(${currentPage - 1})" ${currentPage <= 1 ? 'disabled' : ''}>‚Üê Previous</button>
        <span class="current">Page ${currentPage} of ${totalPages}</span>
        <button onclick="loadJobs(${currentPage + 1})" ${currentPage >= totalPages ? 'disabled' : ''}>Next ‚Üí</button>
      `;
    }
    
    // Escape HTML
    function escapeHtml(str) {
      if (!str) return '';
      return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }
    
    // Filter handlers
    document.getElementById('filter-role').addEventListener('change', (e) => {
      filters.roleId = e.target.value;
      loadJobs(1);
    });
    
    document.getElementById('filter-type').addEventListener('change', (e) => {
      filters.type = e.target.value;
      loadJobs(1);
    });
    
    // Mobile menu
    function toggleMenu() {
      document.getElementById('nav-menu').classList.toggle('active');
    }
    
    // Dropdown toggle for mobile and desktop
    function toggleDropdown(event, dropdownId) {
      event.preventDefault();
      event.stopPropagation();
      
      const dropdown = document.getElementById(dropdownId);
      const isActive = dropdown.classList.toggle('active');
      
      // Update aria-expanded
      const link = dropdown.querySelector('a[aria-haspopup]');
      if (link) {
        link.setAttribute('aria-expanded', isActive);
      }
      
      // Close other dropdowns
      document.querySelectorAll('.nav-dropdown').forEach(item => {
        if (item.id !== dropdownId) {
          item.classList.remove('active');
          const otherLink = item.querySelector('a[aria-haspopup]');
          if (otherLink) {
            otherLink.setAttribute('aria-expanded', 'false');
          }
        }
      });
    }
    
    // Close menu and dropdowns when clicking outside
    document.addEventListener('click', function(event) {
      const menu = document.getElementById('nav-menu');
      const header = document.querySelector('header');
      
      if (header && !header.contains(event.target)) {
        // Close mobile menu
        menu.classList.remove('active');
        document.querySelector('.menu-toggle')?.setAttribute('aria-expanded', 'false');
        
        // Close all dropdowns
        document.querySelectorAll('.nav-dropdown').forEach(item => {
          item.classList.remove('active');
          const link = item.query