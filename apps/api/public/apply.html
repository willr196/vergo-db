<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Join Our Team - VERGO Events | Personally Vetted by Founder</title>
  <meta name="description" content="Join VERGO's growing team of event professionals. Every team member personally vetted by founder with 8+ years experience. Premium rates. Quality clients.">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #0a0a0a; color: #ffffff; line-height: 1.7; }
    
    header { position: fixed; top: 0; left: 0; right: 0; background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(212, 175, 55, 0.2); padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; }
    .logo { font-size: 1.8rem; font-weight: 700; color: #D4AF37; letter-spacing: 2px; text-decoration: none; }
    nav ul { display: flex; gap: 35px; list-style: none; }
    nav a { color: #ffffff; text-decoration: none; font-size: 0.95rem; font-weight: 500; transition: color 0.3s ease; position: relative; }
    nav a::after { content: ''; position: absolute; bottom: -5px; left: 0; width: 0; height: 2px; background: #D4AF37; transition: width 0.3s ease; }
    nav a:hover { color: #D4AF37; }
    nav a:hover::after { width: 100%; }
    .menu-toggle { display: none; flex-direction: column; gap: 5px; cursor: pointer; }
    .menu-toggle span { width: 25px; height: 2px; background: #D4AF37; }
    
    .page-hero { text-align: center; padding: 180px 40px 80px; background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%); border-bottom: 1px solid rgba(212, 175, 55, 0.2); }
    .hero-badge { display: inline-block; background: rgba(212, 175, 55, 0.1); border: 1px solid rgba(212, 175, 55, 0.3); color: #D4AF37; padding: 8px 20px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px; }
    .page-hero h1 { font-size: 4rem; margin-bottom: 20px; color: #D4AF37; font-weight: 700; }
    .page-hero p { font-size: 1.3rem; color: #999; max-width: 800px; margin: 0 auto; }
    
    .container { max-width: 1200px; margin: 0 auto; padding: 80px 40px; }
    
    .intro-section { background: #1a1a1a; padding: 60px 50px; margin-bottom: 80px; border-radius: 8px; border-left: 4px solid #D4AF37; }
    .intro-section h2 { font-size: 2.5rem; margin-bottom: 30px; color: #D4AF37; }
    .intro-section p { font-size: 1.15rem; line-height: 1.9; color: #cccccc; margin-bottom: 20px; }
    .intro-highlight { background: rgba(212, 175, 55, 0.05); border-left: 3px solid #D4AF37; padding: 20px 25px; margin: 30px 0; font-style: italic; color: #D4AF37; font-size: 1.1rem; }
    
    .why-join { margin: 80px 0; }
    .why-join h2 { font-size: 2.5rem; color: #D4AF37; margin-bottom: 50px; text-align: center; }
    .benefits-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
    .benefit-card { background: #1a1a1a; padding: 40px 30px; border-radius: 8px; border-left: 4px solid #D4AF37; }
    .benefit-icon { font-size: 2.5rem; margin-bottom: 15px; display: block; }
    .benefit-card h3 { font-size: 1.5rem; color: #D4AF37; margin-bottom: 15px; }
    .benefit-card p { color: #999; line-height: 1.7; }
    
    .roles-section { margin: 80px 0; }
    .roles-section h2 { font-size: 2.5rem; color: #D4AF37; margin-bottom: 50px; text-align: center; }
    .roles-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; }
    .role-card { background: #1a1a1a; padding: 30px 25px; border-radius: 8px; border-top: 3px solid #D4AF37; transition: transform 0.3s ease; }
    .role-card:hover { transform: translateY(-5px); }
    .role-card h3 { font-size: 1.3rem; color: #D4AF37; margin-bottom: 10px; }
    .role-card p { color: #999; font-size: 0.95rem; }
    
    .standards-section { background: #1a1a1a; padding: 60px 50px; margin: 80px 0; border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.2); }
    .standards-section h2 { font-size: 2.5rem; color: #D4AF37; margin-bottom: 40px; text-align: center; }
    .standards-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; max-width: 1000px; margin: 0 auto; }
    .standard-item { display: flex; gap: 15px; align-items: start; }
    .standard-icon { font-size: 1.5rem; color: #D4AF37; margin-top: 5px; }
    .standard-content h3 { font-size: 1.2rem; color: #D4AF37; margin-bottom: 8px; }
    .standard-content p { color: #cccccc; line-height: 1.7; }
    
    .application-section { margin: 80px 0; }
    .application-section h2 { font-size: 2.5rem; color: #D4AF37; margin-bottom: 30px; text-align: center; }
    .application-form { background: #1a1a1a; padding: 50px 40px; border-radius: 8px; border-left: 4px solid #D4AF37; max-width: 800px; margin: 0 auto; }
    
    .form-group { margin-bottom: 25px; }
    .form-group label { display: block; margin-bottom: 8px; color: #D4AF37; font-weight: 600; font-size: 0.95rem; }
    .form-group input[type="text"],
    .form-group input[type="email"],
    .form-group input[type="tel"],
    .form-group input[type="file"] { width: 100%; padding: 14px; background: #0a0a0a; border: 1px solid #333; border-radius: 4px; color: #ffffff; font-size: 1rem; font-family: inherit; transition: border-color 0.3s ease; }
    .form-group input:focus { outline: none; border-color: #D4AF37; }
    
    /* Roles Checkboxes */
    .roles-category { margin-bottom: 25px; }
    .category-title { font-weight: 600; color: #D4AF37; font-size: 0.95rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #2a2a2a; }
    .role-checkboxes { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; margin-bottom: 20px; }
    .role-checkbox { display: flex; align-items: center; padding: 12px 15px; background: #0a0a0a; border: 2px solid #2a2a2a; border-radius: 6px; cursor: pointer; transition: all 0.2s; user-select: none; }
    .role-checkbox:hover { background: #1a1a1a; border-color: #D4AF37; }
    .role-checkbox input[type="checkbox"] { width: 18px; height: 18px; margin-right: 10px; cursor: pointer; accent-color: #D4AF37; }
    .role-checkbox label { margin: 0; font-weight: 400; font-size: 0.95rem; cursor: pointer; flex: 1; color: #bbb; }
    .role-checkbox input[type="checkbox"]:checked ~ label { font-weight: 600; color: #D4AF37; }
    
    /* File Input Styling */
    input[type="file"]::file-selector-button { padding: 12px 25px; background: #D4AF37; color: #1a1a1a; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; margin-right: 15px; transition: background 0.3s; }
    input[type="file"]::file-selector-button:hover { background: #fff; }
    
    .info-box { background: rgba(212, 175, 55, 0.1); border-left: 3px solid #D4AF37; padding: 20px; margin: 25px 0; border-radius: 4px; color: #cccccc; font-size: 0.95rem; line-height: 1.7; }
    .info-box strong { color: #D4AF37; display: block; margin-bottom: 8px; }
    
    .consent { display: flex; gap: 12px; align-items: flex-start; margin-top: 25px; font-size: 0.95rem; color: #bbb; }
    .consent input[type="checkbox"] { width: 18px; height: 18px; margin-top: 3px; cursor: pointer; accent-color: #D4AF37; flex-shrink: 0; }
    .consent a { color: #D4AF37; text-decoration: none; }
    .consent a:hover { text-decoration: underline; }
    
    .submit-button { width: 100%; padding: 16px; background: #D4AF37; color: #1a1a1a; border: none; border-radius: 4px; font-weight: 700; font-size: 1rem; text-transform: uppercase; letter-spacing: 1.5px; cursor: pointer; transition: all 0.3s ease; margin-top: 20px; }
    .submit-button:hover:not(:disabled) { background: #fff; transform: translateY(-2px); }
    .submit-button:disabled { opacity: 0.6; cursor: not-allowed; }
    
    /* Success Message */
    .success-message { display: none; background: rgba(212, 175, 55, 0.1); border: 2px solid #D4AF37; border-radius: 12px; padding: 50px 40px; text-align: center; margin: 40px 0; }
    .success-message.show { display: block; animation: fadeIn 0.5s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .success-message .icon { font-size: 4rem; margin-bottom: 20px; }
    .success-message h3 { font-size: 2rem; color: #D4AF37; margin-bottom: 15px; }
    .success-message p { font-size: 1.1rem; color: #cccccc; line-height: 1.7; }
    
    footer { background: #0a0a0a; color: #D4AF37; padding: 40px 30px 25px; border-top: 1px solid rgba(212, 175, 55, 0.2); margin-top: 80px; }
    .footer-content { max-width: 1200px; margin: 0 auto; text-align: center; }
    .footer-links { margin-bottom: 20px; }
    .footer-links a { color: #999; text-decoration: none; margin: 0 20px; font-size: 0.9rem; transition: color 0.3s ease; }
    .footer-links a:hover { color: #D4AF37; }
    .footer-bottom { color: #666; font-size: 0.85rem; margin-top: 15px; }
    
    @media (max-width: 1024px) {
      nav ul { position: fixed; top: 80px; left: 0; right: 0; background: rgba(10, 10, 10, 0.98); flex-direction: column; padding: 30px; gap: 20px; transform: translateX(-100%); transition: transform 0.3s ease; }
      nav ul.active { transform: translateX(0); }
      .menu-toggle { display: flex; }
      .standards-grid { grid-template-columns: 1fr; }
    }
    
    @media (max-width: 768px) {
      header { padding: 15px 20px; }
      .logo { font-size: 1.5rem; }
      .page-hero { padding: 140px 20px 60px; }
      .page-hero h1 { font-size: 2.5rem; }
      .container { padding: 60px 20px; }
      .intro-section, .standards-section, .application-form { padding: 40px 25px; }
      .benefits-grid, .roles-grid { grid-template-columns: 1fr; }
      .footer-links a { display: block; margin: 12px 0; }
    }
  </style>
</head>
<body>
  <header>
    <a href="index.html" class="logo">VERGO</a>
    <div class="menu-toggle" onclick="toggleMenu()">
      <span></span><span></span><span></span>
    </div>
    <nav>
      <ul id="nav-menu">
        <li><a href="index.html">Home</a></li>
        <li><a href="hire-us.html">Event Management</a></li>
        <li><a href="hire-staff.html">Hire Staff</a></li>
        <li><a href="apply.html">Join Us</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>
  </header>
  
  <div class="page-hero">
    <div class="hero-badge">Now Hiring Experienced Professionals</div>
    <h1>Join VERGO's Team</h1>
    <p>Work with London's newest premium event agency. Every team member personally vetted by founder with 8+ years experience. Quality clients. Professional rates.</p>
  </div>
  
  <div class="container">
    <div class="intro-section">
      <h2>Why I'm Building VERGO Differently</h2>
      <p>
        After 8 years in London's events industry, I've seen how most agencies treat their staff - 
        as interchangeable numbers rather than valued professionals. I started VERGO to change that.
      </p>
      <p>
        Every team member at VERGO is personally interviewed, reference-checked, and vetted by me. 
        I'm not building a massive roster - I'm building a network of exceptional professionals who 
        take pride in their work and reflect the standards I've held throughout my career.
      </p>
      <div class="intro-highlight">
        "If you join VERGO, you're not just another name on a list. You're part of building something 
        special - an agency that respects event professionals and delivers genuine quality to clients."
        <br><br>- William, Founder
      </div>
    </div>
    
    <div class="why-join">
      <h2>Why Work With VERGO?</h2>
      <div class="benefits-grid">
        <div class="benefit-card">
          <span class="benefit-icon">üí∞</span>
          <h3>Competitive Rates</h3>
          <p>Premium rates that reflect your professional value. We don't undercut - we pay well.</p>
        </div>
        <div class="benefit-card">
          <span class="benefit-icon">üéØ</span>
          <h3>Quality Clients</h3>
          <p>Work with corporate, film, music, and high-end private events. No bottom-tier bookings.</p>
        </div>
        <div class="benefit-card">
          <span class="benefit-icon">üë§</span>
          <h3>Personal Relationship</h3>
          <p>Direct communication with founder. No bureaucracy or going through layers of management.</p>
        </div>
        <div class="benefit-card">
          <span class="benefit-icon">üìÖ</span>
          <h3>Flexible Work</h3>
          <p>Choose your availability. Work when it suits you, turn down what doesn't.</p>
        </div>
        <div class="benefit-card">
          <span class="benefit-icon">üöÄ</span>
          <h3>Growth Opportunities</h3>
          <p>As VERGO grows, so do opportunities for regular work and advancement.</p>
        </div>
        <div class="benefit-card">
          <span class="benefit-icon">ü§ù</span>
          <h3>Respect & Recognition</h3>
          <p>Your professionalism is valued. Great work leads to more bookings and better rates.</p>
        </div>
      </div>
    </div>
    
    <div class="roles-section">
      <h2>Roles We're Hiring</h2>
      <div class="roles-grid">
        <div class="role-card">
          <h3>Front of House</h3>
          <p>Welcoming guests and creating excellent first impressions</p>
        </div>
        <div class="role-card">
          <h3>Bartenders</h3>
          <p>Professional bar service and mixology</p>
        </div>
        <div class="role-card">
          <h3>Waiting Staff</h3>
          <p>Attentive table service for events</p>
        </div>
        <div class="role-card">
          <h3>Event Coordinators</h3>
          <p>Managing events from setup to breakdown</p>
        </div>
        <div class="role-card">
          <h3>Kitchen Porters</h3>
          <p>Supporting kitchen operations at events</p>
        </div>
        <div class="role-card">
          <h3>Technical Crew</h3>
          <p>AV, lighting, sound, and stage professionals</p>
        </div>
      </div>
    </div>
    
    <div class="standards-section">
      <h2>Our Standards</h2>
      <div class="standards-grid">
        <div class="standard-item">
          <span class="standard-icon">‚úì</span>
          <div class="standard-content">
            <h3>Experience Required</h3>
            <p>Demonstrated experience in your role. We verify your background and references.</p>
          </div>
        </div>
        <div class="standard-item">
          <span class="standard-icon">‚úì</span>
          <div class="standard-content">
            <h3>DBS Checked</h3>
            <p>All team members undergo DBS background checks as required by venues and clients.</p>
          </div>
        </div>
        <div class="standard-item">
          <span class="standard-icon">‚úì</span>
          <div class="standard-content">
            <h3>Professional Presentation</h3>
            <p>Excellent personal presentation and communication skills essential.</p>
          </div>
        </div>
        <div class="standard-item">
          <span class="standard-icon">‚úì</span>
          <div class="standard-content">
            <h3>Reliability</h3>
            <p>Consistent punctuality and commitment. Your reputation matters as much as ours.</p>
          </div>
        </div>
        <div class="standard-item">
          <span class="standard-icon">‚úì</span>
          <div class="standard-content">
            <h3>Problem Solving</h3>
            <p>Ability to handle unexpected situations professionally and independently.</p>
          </div>
        </div>
        <div class="standard-item">
          <span class="standard-icon">‚úì</span>
          <div class="standard-content">
            <h3>Client Focus</h3>
            <p>Understanding that exceptional service builds both your reputation and ours.</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="application-section">
      <h2>Apply to Join VERGO</h2>
      <p style="text-align: center; color: #999; margin-bottom: 40px; max-width: 700px; margin-left: auto; margin-right: auto;">
        Tell me about your experience and why you'd be a good fit. I personally review every application.
      </p>
      
      <div id="successMessage" class="success-message">
        <div class="icon">‚úÖ</div>
        <h3>Application Received!</h3>
        <p>Thanks for applying! We'll review your application and get back to you within 2 weeks.</p>
        <p style="margin-top: 20px; font-size: 0.95rem; color: #999;">
          Keep an eye on your email (including spam folder) for updates.
        </p>
      </div>
      
      <form id="f" class="application-form">
        <div class="form-group">
          <label for="firstName">First Name *</label>
          <input type="text" id="firstName" name="firstName" required>
        </div>
        
        <div class="form-group">
          <label for="lastName">Last Name *</label>
          <input type="text" id="lastName" name="lastName" required>
        </div>
        
        <div class="form-group">
          <label for="email">Email Address *</label>
          <input type="email" id="email" name="email" required>
        </div>
        
        <div class="form-group">
          <label for="phone">Phone Number *</label>
          <input type="tel" id="phone" name="phone" required>
        </div>
        
        <div class="form-group">
          <label>
            <input type="checkbox" id="rightToWorkUk" name="rightToWorkUk" style="width: auto; margin-right: 10px;" required>
            I have the right to work in the UK *
          </label>
        </div>
        
        <!-- Role Selection -->
        <div class="form-group">
          <label>Select All Roles You Can Do * (check all that apply)</label>
          
          <div class="roles-category">
            <div class="category-title">üçΩÔ∏è Hospitality & Service</div>
            <div class="role-checkboxes">
              <div class="role-checkbox">
                <input type="checkbox" id="role-bartender" name="roles" value="Bartender" />
                <label for="role-bartender">Bartender</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-mixologist" name="roles" value="Mixologist" />
                <label for="role-mixologist">Mixologist</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-waiter" name="roles" value="Waiting Staff" />
                <label for="role-waiter">Waiting Staff</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-foh" name="roles" value="Front of House (FOH)" />
                <label for="role-foh">Front of House</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-host" name="roles" value="Host/Hostess" />
                <label for="role-host">Host/Hostess</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-chef" name="roles" value="Chef" />
                <label for="role-chef">Chef</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-sous" name="roles" value="Sous Chef" />
                <label for="role-sous">Sous Chef</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-cdp" name="roles" value="Chef de Partie" />
                <label for="role-cdp">Chef de Partie</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-kp" name="roles" value="Kitchen Porter (KP)" />
                <label for="role-kp">Kitchen Porter</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-runner" name="roles" value="Runner" />
                <label for="role-runner">Runner</label>
              </div>
            </div>
          </div>
          
          <div class="roles-category">
            <div class="category-title">üé™ Events & Production</div>
            <div class="role-checkboxes">
              <div class="role-checkbox">
                <input type="checkbox" id="role-event-mgr" name="roles" value="Event Manager" />
                <label for="role-event-mgr">Event Manager</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-supervisor" name="roles" value="Event Supervisor" />
                <label for="role-supervisor">Event Supervisor</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-stagehand" name="roles" value="Stagehand" />
                <label for="role-stagehand">Stagehand</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-site-crew" name="roles" value="Site Crew" />
                <label for="role-site-crew">Site Crew</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-rigger" name="roles" value="Rigger" />
                <label for="role-rigger">Rigger</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-loader" name="roles" value="Loader" />
                <label for="role-loader">Loader</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-av" name="roles" value="AV Technician" />
                <label for="role-av">AV Technician</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-lighting" name="roles" value="Lighting Tech" />
                <label for="role-lighting">Lighting Tech</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-sound" name="roles" value="Sound Tech" />
                <label for="role-sound">Sound Tech</label>
              </div>
            </div>
          </div>
          
          <div class="roles-category">
            <div class="category-title">üè¢ Venue & Operations</div>
            <div class="role-checkboxes">
              <div class="role-checkbox">
                <input type="checkbox" id="role-steward" name="roles" value="Steward" />
                <label for="role-steward">Steward</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-security" name="roles" value="Security (SIA)" />
                <label for="role-security">Security (SIA)</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-cleaner" name="roles" value="Cleaner" />
                <label for="role-cleaner">Cleaner</label>
              </div>
              <div class="role-checkbox">
                <input type="checkbox" id="role-driver" name="roles" value="Driver" />
                <label for="role-driver">Driver</label>
              </div>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="cv">Your CV (PDF or Word) *</label>
          <input 
            type="file" 
            id="cv" 
            name="cv"
            accept=".pdf,.doc,.docx" 
            required 
          />
        </div>
        
        <div class="info-box">
          <strong>What happens next?</strong>
          We review all applications within 48 hours. If you're a good fit, I'll reach out directly to discuss opportunities. Maximum file size: 10MB.
        </div>
        
        <label class="consent">
          <input type="checkbox" id="consent" required />
          <span>
            I agree to VERGO processing my personal data for the purpose of handling my
            application, in line with the
            <a href="privacy.html" target="_blank" rel="noopener">Privacy Policy</a>.
          </span>
        </label>
        
        <button type="submit" class="submit-button">Submit Application</button>
      </form>
    </div>
  </div>
  
  <footer>
    <div class="footer-content">
      <div class="footer-links">
        <a href="index.html">Home</a>
        <a href="hire-us.html">Event Management</a>
        <a href="hire-staff.html">Hire Staff</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a href="privacy.html">Privacy</a>
        <a href="terms.html">Terms</a>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 VERGO Events Ltd. All rights reserved.</p>
        <p style="margin-top: 5px;">Founded by industry professionals ‚Ä¢ 8+ years experience ‚Ä¢ Building exceptional teams</p>
      </div>
    </div>
  </footer>
  
  <script>
    function toggleMenu() {
      const menu = document.getElementById('nav-menu');
      menu.classList.toggle('active');
    }
    document.addEventListener('click', function(event) {
      const menu = document.getElementById('nav-menu');
      const header = document.querySelector('header');
      if (header && !header.contains(event.target)) {
        menu.classList.remove('active');
      }
    });
    
    // Application form with S3 upload
    (function () {
      const form = document.getElementById('f');
      if (!form) return;

      async function presign(file) {
        const body = { fileName: file.name, fileType: file.type || 'application/octet-stream' };
        const res = await fetch('/api/v1/applications/presign', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });
        if (!res.ok) throw new Error('Failed to presign CV upload');
        return res.json(); // Returns { url, key, applicantId }
      }

      async function uploadToS3(url, file) {
        const up = await fetch(url, {
          method: 'PUT',
          headers: { 'Content-Type': file.type || 'application/octet-stream' },
          body: file
        });
        if (!up.ok) throw new Error('S3 upload failed');
      }

      async function verifyUpload(key) {
        const res = await fetch('/api/v1/applications/verify-upload', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ key })
        });
        if (!res.ok) throw new Error('Failed to verify upload');
        return res.json();
      }

      function getRoles() {
        return Array.from(document.querySelectorAll('input[name="roles"]:checked')).map(x => x.value);
      }

      function bool(name) {
        const el = form.querySelector(`[name="${name}"]`);
        if (!el) return undefined;
        if (el.type === 'checkbox') return el.checked;
        return undefined;
      }

      function val(name) {
        const el = form.querySelector(`[name="${name}"]`);
        return el ? el.value.trim() : '';
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const btn = form.querySelector('[type="submit"]');
        const originalText = btn.textContent;
        if (btn) btn.disabled = true;
        btn.textContent = 'Uploading CV...';

        try {
          // 0) Grab CV file
          const fileInput = form.querySelector('input[type="file"]');
          const file = fileInput && fileInput.files && fileInput.files[0];
          if (!file) throw new Error('Please attach your CV');

          // Validate file size
          const MAX_SIZE = 10 * 1024 * 1024; // 10MB
          if (file.size > MAX_SIZE) {
            throw new Error('CV file is too large. Maximum size is 10MB.');
          }

          // Validate roles selected
          const roles = getRoles();
          if (roles.length === 0) {
            throw new Error('Please select at least one role');
          }

          // 1) Presign - Get URL, key, AND applicantId
          console.log('Step 1: Getting presigned URL...');
          const presignResponse = await presign(file);
          const { url, key, applicantId } = presignResponse;
          console.log('Got presigned URL and applicantId:', applicantId);

          // 2) Upload to S3
          console.log('Step 2: Uploading to S3...');
          btn.textContent = 'Uploading CV to server...';
          await uploadToS3(url, file);
          console.log('Upload complete');

          // 3) Verify upload
          console.log('Step 3: Verifying upload...');
          btn.textContent = 'Verifying upload...';
          await verifyUpload(key);
          console.log('Verification complete');

          // 4) Submit application
          console.log('Step 4: Submitting application...');
          btn.textContent = 'Submitting application...';
          const payload = {
            applicantId: applicantId,  // CRITICAL: Include this!
            firstName: val('firstName'),
            lastName: val('lastName'),
            email: val('email'),
            phone: val('phone') || undefined,
            rightToWorkUk: bool('rightToWorkUk'),
            roles: roles,
            cvKey: key,
            cvOriginalName: file.name,
            source: 'website'
          };

          console.log('Payload:', payload);

          const res = await fetch('/api/v1/applications', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if (!res.ok) {
            const err = await res.json().catch(() => ({}));
            throw new Error(err?.error || 'Application submission failed');
          }

          console.log('Application submitted successfully!');
          
          // Show success message
          form.style.display = 'none';
          document.getElementById('successMessage').classList.add('show');
          document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth', block: 'center' });
          
        } catch (err) {
          console.error('Application error:', err);
          alert('‚ö†Ô∏è ' + (err.message || 'Something went wrong submitting your application.\n\nPlease try again or contact us at wrobb@vergoltd.com'));
        } finally {
          if (btn) {
            btn.disabled = false;
            btn.textContent = originalText;
          }
        }
      });
    })();
  </script>
</body>
</html>